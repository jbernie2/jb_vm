/**
 * jb_vm 0.0.1 built on 2016-01-03.
 * Copyright (c) 2015 John Bernier <john.b.bernier@gmail.com>
 *
 * https://github.com/jbernie2/vm_js
 */

"use strict";var OPCODE_OFFSET=24,DEST_REG_OFFSET=20,SRC_REG_1_OFFSET=16,SRC_REG_2_OFFSET=12,CONSTANT_OFFSET=0,OPCODE_NAMES=["halt","add","loadi"],OPCODE_VALUES={halt:0,add:1,loadi:2},REGISTERS={reg0:0,reg1:1,reg2:2,reg3:3,reg4:4,reg5:5,reg6:6,reg7:7,reg8:8,reg9:9,rega:10,regb:11,vm:12,ih:13,sp:14,pc:15},pc=0,running=!0,stack=[],registers={reg0:0,reg1:1,reg2:2,reg3:3,reg4:4,reg5:5,reg6:6,reg7:7,reg8:8,reg9:9,rega:10,regb:11,vm:12,ih:13,sp:14,pc:0},halt=function(a){running=!1,console.log("halting")},add=function(a){console.log("add")},loadi=function(a){console.log("loadi")},instructions={halt:halt,loadi:loadi,add:add},fetch=function(){var a=memory[registers.pc];return registers.pc+=1,a},decode=function(a){return{opcode:(4278190080&a)>>>OPCODE_OFFSET,dest_reg:(15728640&a)>>>DEST_REG_OFFSET,src_reg_1:(983040&a)>>>SRC_REG_1_OFFSET,src_reg_2:(61440&a)>>>SRC_REG_2_OFFSET,constant:(65535&a)>>>CONSTANT_OFFSET}},evaluate=function(a){var b=OPCODE_NAMES[a.opcode],c=instructions[b];c(a)},main=function(){for(;running;)evaluate(decode(fetch()))},pack_instruction=function(a){var b,c,d=a[0],e=a[1],f=a[2],g=a[3],h=a[4];if(d){var i=OPCODE_VALUES[d];b=pack(b,i,OPCODE_OFFSET)}return e&&(c=REGISTERS[e],b=pack(b,c,DEST_REG_OFFSET)),f&&(c=REGISTERS[f],b=pack(b,c,SRC_REG_1_OFFSET)),g&&(c=REGISTERS[g],b=pack(b,c,SRC_REG_2_OFFSET)),h&&(b=pack(b,h,CONSTANT_OFFSET)),b},pack=function(a,b,c){return a|b<<c},memory=[["loadi","reg1",null,null,1],["loadi","reg2",null,null,2],["add","reg3","reg1","reg2",null],["halt",null,null,null,null]].map(pack_instruction);main(),console.log("packing loadi reg1 5: "+pack_instruction(["loadi","reg1",null,null,5]).toString(16));
//# sourceMappingURL=jb_vm-min.js.map