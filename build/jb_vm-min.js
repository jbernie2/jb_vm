/**
 * jb_vm 0.0.1 built on 2016-01-03.
 * Copyright (c) 2015 John Bernier <john.b.bernier@gmail.com>
 *
 * https://github.com/jbernie2/vm_js
 */

"use strict";var OPCODE_OFFSET=24,DEST_REG_OFFSET=20,SRC_REG_1_OFFSET=16,SRC_REG_2_OFFSET=12,CONSTANT_OFFSET=0,OPCODES={halt:0,loadi:1,add:2},REGISTERS={reg0:0,reg1:1,reg2:2,reg3:3,reg4:4,reg5:5,reg6:6,reg7:7,reg8:8,reg9:9,rega:10,regb:11,vm:12,ih:13,sp:14,pc:15},pc=0,running=!0,stack=[],registers={reg0:0,reg1:1,reg2:2,reg3:3,reg4:4,reg5:5,reg6:6,reg7:7,reg8:8,reg9:9,rega:10,regb:11,vm:12,ih:13,sp:14,pc:15},halt=function(){running=!1,console.log("halting")},loadi=function(){return function(a){return function(b){registers[a]=b,console.log(a+" = "+registers[a])}}},add=function(){return function(a){return function(b){return function(c){registers[a]=registers[b]+registers[c],console.log(a+" = "+b+" + "+c),console.log(registers[a]+" = "+registers[b]+" + "+registers[c])}}}},sub=function(){return function(a){return function(b){return function(c){registers[a]=registers[b]-registers[c],console.log(a+" = "+b+" - "+c),console.log(registers[a]+" = "+registers[b]+" - "+registers[c])}}}},mul=function(){return function(a){return function(b){return function(c){registers[a]=registers[b]*registers[c],console.log(a+" = "+b+" * "+c),console.log(registers[a]+" = "+registers[b]+" * "+registers[c])}}}},div=function(){return function(a){return function(b){return function(c){registers[a]=registers[b]/registers[c],console.log(a+" = "+b+" / "+c),console.log(registers[a]+" = "+registers[b]+" / "+registers[c])}}}},instructions={halt:halt,loadi:loadi,add:add,sub:sub,mul:mul,div:div},fetch=function(){var a=prog[pc];return pc+=1,a},decode=function(a){return{opcode:(4278190080&a)>>>OPCODE_OFFSET,dest_reg:(15728640&a)>>>DEST_REG_OFFSET,src_reg_1:(983040&a)>>>SRC_REG_1_OFFSET,src_reg_2:(61440&a)>>>SRC_REG_2_OFFSET,constant:(65535&a)>>>CONSTANT_OFFSET}},evaluate=function(){var a;return function(b){void 0!==a?(a=a(b),"function"!=typeof a&&(a=void 0)):a=instructions[b]()}}(),main=function(){for(;running;)evaluate(fetch())},pack_instruction=function(a,b,c,d,e){var f,g;if(a){var h=OPCODES[a];f=pack(f,h,OPCODE_OFFSET)}return b&&(g=REGISTERS[b],f=pack(f,g,DEST_REG_OFFSET)),c&&(g=REGISTERS[c],f=pack(f,g,SRC_REG_1_OFFSET)),d&&(g=REGISTERS[d],f=pack(f,g,SRC_REG_2_OFFSET)),e&&(f=pack(f,e,CONSTANT_OFFSET)),f},pack=function(a,b,c){return a|b<<c},prog=["loadi","reg1",1,"loadi","reg2",2,"add","reg3","reg1","reg2","halt"];main(),console.log("packing loadi reg1 5: "+pack_instruction("loadi","reg1",null,null,5).toString(16));
//# sourceMappingURL=jb_vm-min.js.map